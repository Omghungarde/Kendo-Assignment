<kendo-grid
      #grid
      [data]="gridSettings.gridData"
      [resizable]="true"
      [reorderable]="true"
      [columnMenu]="true"
      [pageable]="true"
      [pageSize]="gridSettings.state.take"
      [skip]="gridSettings.state.skip"
      [sortable]="true"
      [sort]="gridSettings.state.sort"
      [filterable]="true"
      [filter]="gridSettings.state.filter"
      [groupable]="true"
      [group]="gridSettings.state.group"
      (dataStateChange)="dataStateChange($event)"
      (cellClick)="cellClickHandler($event)"
      (dblclick)="onDblClick()"
      (cellClose)="cellCloseHandler($event)"
    >
      <ng-template kendoGridToolbarTemplate>
        <button kendoButton (click)="saveGridSettings(grid)">
          Save current state
        </button>
        @if (savedStateExists) {
            <button kendoButton (click)="loadSavedState()">
                Load saved state
              </button>
              
        }
      </ng-template>
      @for (col of gridSettings.columnsConfig; track col) {
      <kendo-grid-column
        [field]="col.field"
        [title]="col.title"
        [width]="col.width ?? 100"
        [filter]="col.filter ?? 'text'"
        [filterable]="col.filterable ?? false"
        [hidden]="col.hidden ?? false"
        [format]="col.format"
        [editable]="true"
        (dblclick)="onCellDoubleClick($event)"
      >
      <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
        <input
          kendoTextBox
          [formControl]="formGroup.get(col.field)"
          [placeholder]="col.title"
        />
      </ng-template>
      </kendo-grid-column>
      }
    </kendo-grid>

    <div class="preferences-container">
        <button kendoButton (click)="saveGridSettings(grid)">Save Preference</button>
        <select id="preferenceName" [(ngModel)]="selectedPreference" (change)="loadSavedState()">
          <option *ngFor="let preference of savedPreferences" [value]="preference">
            {{ preference }}
          </option>
        </select>
        <button kendoButton (click)="clearPreference()">Clear Preference</button>
      </div>

      <kendo-dialog *ngIf="isPreferencePopupOpen" (close)="closePreferencePopup()">
        <kendo-dialog-titlebar>
          Save Preference
        </kendo-dialog-titlebar>
        <div class="popup-content">
          <label for="preferenceInput">Preference Name:</label>
          <input id="preferenceInput" [(ngModel)]="newPreferenceName" />
        </div>
        <kendo-dialog-actions>
          <button kendoButton (click)="saveNewPreference()">Save</button>
          <button kendoButton (click)="closePreferencePopup()">Cancel</button>
        </kendo-dialog-actions>
      </kendo-dialog>

